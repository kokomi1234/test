# redis.conf for Redis Cluster
# 这个配置文件用于 Redis 集群节点，通常用于外部可访问的集群配置。

# Redis 服务器监听的端口
# 参数规范：port <port_number>
# 默认值：6379
# 描述：指定 Redis 服务器监听的 TCP 端口。在集群环境中，每个节点通常使用相同的内部端口。
port 6379

# Redis 服务器绑定的 IP 地址
# 参数规范：bind <ip_address> [ip_address ...]
# 默认值：127.0.0.1 (仅限本地访问)
# 描述：指定 Redis 服务器监听的 IP 地址。0.0.0.0 表示监听所有可用的网络接口，
# 允许来自任何 IP 地址的连接，这在 Docker 容器中是常见的配置。
bind 0.0.0.0

# 开启集群模式
# 参数规范：cluster-enabled <yes|no>
# 默认值：no
# 描述：设置为 yes 以启用 Redis 集群功能。这是构建 Redis 集群的先决条件。
cluster-enabled yes

# 集群内部的配置文件，由 Redis 自动维护
# 参数规范：cluster-config-file <filename>
# 默认值：nodes.conf
# 描述：Redis 集群节点用来保存集群状态（如节点 ID、IP、端口、槽位分配等）的文件。
# 这个文件由 Redis 自动生成和维护，不应手动编辑。通常放置在数据目录下。
cluster-config-file /data/nodes.conf

# 节点超时时间（毫秒）
# 参数规范：cluster-node-timeout <milliseconds>
# 默认值：15000 (15秒)
# 描述：节点被认为不可用（fail）的超时时间。如果一个节点在此时间内没有响应，
# 其他节点会认为它已经下线。单位是毫秒。
cluster-node-timeout 5000

# 开启 AOF 持久化
# 参数规范：appendonly <yes|no>
# 默认值：no
# 描述：设置为 yes 以启用 AOF 持久化。AOF 以日志形式记录每个写操作，
# 并在 Redis 重启时重新执行这些操作来恢复数据，提供更好的数据安全性。
appendonly yes

# 集群通告 IP 和端口 (Docker DNS 服务发现)
# 参数规范：cluster-announce-ip <ip_address_or_hostname>
# 描述：使用 Docker 容器名作为通告 IP，Docker 的内置 DNS 服务器会自动
# 将容器名解析为容器在自定义网络中的内部 IP 地址。这种方式更稳定、高效。
# 集群内部通信使用容器网络，外部客户端通过端口映射访问。
cluster-announce-ip redis-node-2

# 参数规范：cluster-announce-port <port_number>
# 描述：通告容器内部的 Redis 端口（6379），而不是宿主机映射端口。
# 集群节点间通信使用容器内部端口，外部访问通过 docker-compose.yml 的端口映射。
cluster-announce-port 6379

# 参数规范：cluster-announce-bus-port <port_number>
# 描述：Redis 集群总线端口，用于节点间内部通信（心跳、配置更新等）。
# 使用容器内部的集群总线端口（Redis端口 + 10000 = 16379）。
cluster-announce-bus-port 16379